{"version":3,"file":"vue.js","sources":["../utils.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFunction(data){\r\n    return typeof data === 'function'\r\n}\r\n\r\nexport function isObject(data){\r\n    return typeof data === 'object' && data !== null\r\n}","let oldArrayPrototype = Array.prototype\r\nexport let arrayMethods = Object.create(oldArrayPrototype)\r\n//以Array的原型作为当前对象的原型 arrayMehthods.__proto__ = Array.prototype\r\n\r\nlet methods = [\r\n    'push',\r\n    'shift',\r\n    'unshift',\r\n    'pop',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    //用户如果调用以上七个方法会用我自己重写的，否则用数组原来的方法\r\n    arrayMethods[method] = function(...args){\r\n        oldArrayPrototype[method].call(this,...args)\r\n        //根据当前数组获取Observer类的实例\r\n        //这里的this指向数组\r\n        let ob = this.__ob__ \r\n        let inserted\r\n\r\n        switch(method){\r\n            case 'push':\r\n                inserted = args //args就是新增的内容\r\n            case 'unshift': \r\n                inserted = args//args就是新增的内容\r\n            case 'splice':\r\n                //xxx.splice(0,1,xxx) 在下标为0的地方插入一个数xxx \r\n                //此时args的第三个参数就是xxx 为新增的内容  \r\n                inserted = args.slice(2)   \r\n            default:\r\n                break;    \r\n        } \r\n        //如果有新增的内容要继续进行劫持，需要观察数组的每一项，而不是数组\r\n        if(inserted){\r\n              ob.observeArray(inserted)\r\n        }\r\n    }\r\n})","import { isObject } from \"../../utils\";\r\nimport {arrayMethods} from './array'\r\n\r\nclass Observer{\r\n    constructor(data){ \r\n        //这里的this是Observer类的实例\r\n        //给data添加__ob__属性，这是为了如果data是数组的情况下，可以访问Observer类上的方法observeArray\r\n        //所有被劫持的属性都有__ob__\r\n        //写成这种形式是为了防止如果是对象走walk方法然后添加了__ob__,因为__ob__对应的this是一个实例对象，所以会不停地对__ob__进行观测，导致爆栈\r\n        Object.defineProperty(data,'__ob__',{\r\n            value:this,\r\n            enumerable:false //不可枚举\r\n        })\r\n        //对于数组，Vue没有监控索引的变化，但是如果索引对应的数据是对象需要被监控 \r\n        if(Array.isArray(data)){\r\n            //数组劫持的逻辑\r\n            //对数组原来的方法进行改写，切片编程，高阶函数\r\n            data.__proto__ = arrayMethods\r\n            //如果数组里面的数据是对象类型，那么需要监控对象的变化\r\n            this.observeArray(data)\r\n        }else{\r\n            this.walk(data)//对对象所有属性进行劫持\r\n        }\r\n     \r\n\r\n    }\r\n    observeArray(data){ //对于数组中的对象再次进行监控 递归\r\n        data.forEach(item => {\r\n            observe(item)\r\n        })\r\n    }\r\n    walk(data){\r\n        //Object.keys保证是对对象的私有属性进行遍历\r\n        Object.keys(data).forEach(key=>{\r\n            defineReactive(data,key,data[key])\r\n        })\r\n    }\r\n}\r\n\r\n//Vue2会对对象进行遍历一次，为每个属性添加set/get方法，所以性能会差一点\r\nfunction defineReactive(data,key,value){\r\n    //value有可能是对象，进行递归，为value下面的属性添加set/get方法（所以性能会比较差）\r\n    observe(value)\r\n    Object.defineProperty(data,key,{\r\n        get(){\r\n            return value\r\n        },\r\n        set(newValue){\r\n            observe(newValue) //如果用户赋值一个新对象，需要对这个新对象进行劫持\r\n            value = newValue\r\n        }\r\n    })\r\n\r\n}\r\n\r\nexport function observe(data){\r\n    //是对象才进行观测\r\n    if(!isObject(data)){\r\n         return \r\n    }\r\n    if(data.__ob__){\r\n        //如果data有__ob__属性，说明已经被观测过了\r\n        return \r\n    }\r\n    return new Observer(data)\r\n}\r\n\r\n/**\r\n * 小结：\r\n * 如果数据是对象，会不断递归进行劫持\r\n * 如果是数组，会劫持数组的方法，如果数组中的数据是对象，还会进行检测劫持\r\n */","import { isFunction } from \"../utils\"\r\nimport { observe } from \"./observer/index.js\"\r\nexport function initState(vm){\r\n    const opts = vm.$options\r\n    if(opts.data){\r\n        initData(vm)\r\n    }\r\n    // if(opts.computed){\r\n    //     initComputed()\r\n    // }\r\n    // if(opts.watch){\r\n    //     initWatch()\r\n    // }\r\n    // if(opts.props){\r\n    //     initProps()\r\n    // }\r\n}\r\n\r\nfunction proxy(vm,source,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key]\r\n        },\r\n        set(newValue){\r\n            vm[source][key] = newValue\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm){\r\n    let data = vm.$options.data\r\n    //判断data是否是函数，如果是函数就通过call调用 this指向vm\r\n    //这时候data与vm没有关系，所以添加vm._data，通过_data进行关联\r\n    data = vm._data = isFunction(data)?data.call(vm):data\r\n\r\n    for(let key in data){ //设置代理，直接通过vm.xxx访问而不是通过vm._data.xxx访问\r\n        proxy(vm,'_data',key)\r\n    }\r\n   //通过Object.defineProperty进行数据劫持\r\n    observe(data)\r\n}","export function compileToFunction(template){\r\n    console.log(template)\r\n\r\n}","import { initState } from \"./state\"\r\nimport {compileToFunction} from './compiler/index'\r\nexport function initMixin(Vue){  //表示在Vue的基础上做一次混合操作\r\n\r\n    Vue.prototype._init= function(options){ //Vue原型上添加_init方法\r\n        const vm= this\r\n        vm.$options = options //后续对options进行扩展操作\r\n\r\n        //对数据进行初始化 watch computed props data ... initState专门对状态进行初始化\r\n        initState(vm)\r\n\r\n\r\n        if(vm.$options.el){\r\n            //将数据挂载到模版上\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n    Vue.prototype.$mount = function(el){\r\n        const vm = this\r\n        const options = vm.$options\r\n        el = document.querySelector(el)\r\n        //把模版转化成对应的渲染函数 => 虚拟dom概念 生成vnode => diff算法 更新虚拟dom =>产生真实节点，进行更新\r\n        if(!options.render){//没有render用template\r\n            let template = options.template\r\n            if(!template && el ){ //如果没有template但是有el\r\n                template = el.outerHTML\r\n                let render = compileToFunction(template)\r\n                options.render = render //生成渲染函数\r\n            }\r\n        }\r\n\r\n    }\r\n}","import {initMixin} from './init.js'\r\n\r\nfunction Vue(options){\r\n\r\n    //options是用户传入的配置项,_表示的是Vue内部调用，希望用户不要调用\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\n\r\n\r\nexport default Vue"],"names":["isFunction","data","isObject","oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","ob","__ob__","inserted","slice","observeArray","Observer","defineProperty","value","enumerable","isArray","__proto__","walk","item","observe","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","compileToFunction","template","console","log","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}